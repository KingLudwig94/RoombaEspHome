<!DOCTYPE html>
<!-- saved from url=(0045)https://www.crc.id.au/hacking-the-roomba-600/ -->
<html lang="en" style="height: 1272px;"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Hacking the Roomba 600 | Steve's Blog</title>
<link href="./Hacking the Roomba 600 _ Steve&#39;s Blog_files/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="https://www.crc.id.au/rss.xml">
<link rel="canonical" href="https://www.crc.id.au/hacking-the-roomba-600/">
<!--[if lt IE 9]>
            <script src="../assets/js/html5shiv.min.js"></script>
            <script src="../assets/js/respond.min.js"></script>
        <![endif]--><meta name="author" content="Steven Haigh">
<script async="" src="./Hacking the Roomba 600 _ Steve&#39;s Blog_files/embed.js.download"></script><link rel="prefetch" as="style" href="https://c.disquscdn.com/next/embed/styles/lounge.7ab903feba7624935283ca4c7d8c7203.css"><link rel="prefetch" as="script" href="https://c.disquscdn.com/next/embed/common.bundle.f612a596225060ba8aa2aa903e502caf.js"><link rel="prefetch" as="script" href="https://c.disquscdn.com/next/embed/lounge.bundle.f0599c2118b43a53a7ddae9c471ea77c.js"><link rel="prefetch" as="script" href="https://disqus.com/next/config.js"><script async="" id="dsq_recs_scr" src="./Hacking the Roomba 600 _ Steve&#39;s Blog_files/recommendations.js.download"></script><link rel="prefetch" as="style" href="https://c.disquscdn.com/next/recommendations/styles/recommendations.10022a97346f1c6e3798931bbd8e4bb5.css"><link rel="prefetch" as="script" href="https://c.disquscdn.com/next/recommendations/common.bundle.a3659a8e961f4dff2575f07c23268b7f.js"><link rel="prefetch" as="script" href="https://c.disquscdn.com/next/recommendations/recommendations.bundle.926bc472e4859a48daa346b4ba2ab4f4.js"><link rel="prefetch" as="script" href="https://disqus.com/next/config.js"></head>
<body style="height: 1272px;">
<a href="https://www.crc.id.au/hacking-the-roomba-600/#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-info header-panel shadow-z-3" role="navigation"><div class="container-fluid">
        <div class="row">
          <div class="col-xs-3">
            <h1 class="title-blog">
                <a href="https://www.crc.id.au/">
                        <span id="blog-title">Steve's Blog</span>
                    </a>
            </h1>
          </div>
          <div class="col-xs-9">
            <a id="hamburger" class="btn btn-raised" href="javascript:void(0);" onclick="menuToggle();">☰</a>
          </div>
        </div>
      </div>
<!-- /.container-fluid -->
</nav><div class="container-fluid main" id="content" role="main" style="height: 1106px;">
        <div class="row">
            <nav class="col-xs-12 col-sm-3 menu" style="height: 1106px;">

<form method="get" action="https://duckduckgo.com/">
<input type="hidden" name="sites" value="https://www.crc.id.au/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" class="search" placeholder="Search with DuckDuckGo..."><input type="submit" value="DuckDuckGo Search" style="visibility: hidden; height: 0; width: 0; padding: 0; margin: 0; border: 0;">
</form>

<h4>Articles</h4>
<ul>
<div>
<li class="sidemenu"><a href="https://www.crc.id.au/backups-and-filesystem-deduplication/">Backups and Filesystem Deduplication</a></li>
<li class="sidemenu"><a href="https://www.crc.id.au/cyberpower-ols1000e-fan-replacements/">CyberPower OLS1000E UPS fan replacements</a></li>
<li class="sidemenu"><a href="https://www.crc.id.au/hacking-the-grandstream-bt-100/">Hacking the Grandstream BT-100</a></li>
<li class="sidemenu"><a href="https://www.crc.id.au/hacking-the-roomba-600/">Hacking the Roomba 600</a></li>
<li class="sidemenu"><a href="https://www.crc.id.au/hacking-the-technicolor-tg799vac-and-unlocking-features/">Hacking the Technicolor TG799vac (and unlocking features!)</a></li>
<li class="sidemenu"><a href="https://www.crc.id.au/linux-and-usb-full-disk-encryption/">Linux and USB Full Disk Encryption</a></li>
<li class="sidemenu"><a href="https://www.crc.id.au/ontrak-adu-218-on-linux/">Ontrak ADU-218 on Linux HOWTO</a></li>
<li class="sidemenu"><a href="https://www.crc.id.au/openvpn-otp-with-a-yubikey/">OpenVPN OTP with a Yubikey</a></li>
<li class="sidemenu"><a href="https://www.crc.id.au/pcrd-pcr1000-on-linux/">pcrd - PCR1000 on Linux</a></li>
<li class="sidemenu"><a href="https://www.crc.id.au/public-ntp-server-statistics/">Public NTP Server Statistics</a></li>
<li class="sidemenu"><a href="https://www.crc.id.au/pwm-to-voltage-controlled-fan-hub-conversion/">PWM to voltage controlled fan hub conversion</a></li>
<li class="sidemenu"><a href="https://www.crc.id.au/real-console-on-linksys-srw2024-switch/">Real console on Linksys SRW2024 switch</a></li>
<li class="sidemenu"><a href="https://www.crc.id.au/xplane/essendon/">Real procedures at Essendon Airport</a></li>
<li class="sidemenu"><a href="https://www.crc.id.au/tracking-people-via-wifi-even-when-not-connected/">Tracking people via WiFi (even when not connected)</a></li>
<li class="sidemenu"><a href="https://www.crc.id.au/tsm-and-removable-usb-disks/">TSM and removable USB disks</a></li>
<li class="sidemenu"><a href="https://www.crc.id.au/unison-on-windows/">Unison on Windows</a></li>
<li class="sidemenu"><a href="https://www.crc.id.au/using-centralised-management-with-lets-encrypt/">Using centralised management with Lets Encrypt</a></li>
<li class="sidemenu"><a href="https://www.crc.id.au/virtual-mail-hosting-on-el6/">Virtual Mail hosting on EL6</a></li>
<li class="sidemenu"><a href="https://www.crc.id.au/why-i-founded-melbourne-wireless/">Why I founded Melbourne Wireless</a></li>
<li class="sidemenu"><a href="https://www.crc.id.au/xen-performance-guide/">Xen Performance Guide</a></li>
<li class="sidemenu"><a href="https://www.crc.id.au/xplane-in-australia/">Xplane in Australia</a></li>
</div>
</ul>
<h4>Current Bug Lists</h4>
<ul>
<li><a href="https://www.crc.id.au/redhat-reported-bugs/">RHEL / Fedora</a></li>
<li><a href="https://www.crc.id.au/kernel-reported-bugs/">Kernel.org</a></li>
</ul>
<h4>Other Projects</h4>
<ul>
<li><a href="https://xen.crc.id.au/">Xen made Easy</a></li>
<li><a href="https://marlin.crc.id.au/">Marlin Firmware</a></li>
</ul>
<h4>Other Resources</h4>
<ul>
<li><a href="https://www.crc.id.au/keymaster/">Keymaster Secure Download</a></li>
<li><a href="https://sks-keyservers.net/pks/lookup?op=vindex&amp;fingerprint=on&amp;search=0x41AF35D57A7D31DC">My GPG Key</a></li>
</ul>

<ul></ul></nav><div class="posts-material col-xs-12 col-sm-9" style="height: 1272px;">
                <div class="col-xs-12 col-md-11 content-material">
<article class="post-text storypage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="https://www.crc.id.au/hacking-the-roomba-600/" class="u-url">Hacking the Roomba 600</a></h1>
<hr></header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>I was in the market for a new vacuum. My old manual one was on the way out, and I'd heard a lot about Roombas, but never actually seen one.
I didn't know what they were like, if they were useful, or how well they worked. I came across <a href="https://www.youtube.com/watch?v=t2NgA8qYcFI">this YouTube video</a>
from <a href="https://www.youtube.com/channel/UC2gyzKcHbYfqoXA5xbyGXtQ">The Hook Up</a> which describes hacking the Roomba's 'Open Interface' to talk to it
over a serial link. Considering the base level Roombas were cheaper than a manual vacuum, I thought I'd give it a go.</p>
<p>The good news, the specification is <a href="https://www.irobotweb.com/-/media/MainSite/PDFs/About/STEM/Create/iRobot_Roomba_600_Open_Interface_Spec.pdf?la=en">completely documented</a>.</p>
<p>The Arduino sketch given on <a href="https://github.com/thehookup/MQTT-Roomba-ESP01/blob/master/RoombaESP01_CONFIGURE.ino">The Hook Up</a> github site was a good start,
but I found many issues with it - and me being me - has ended up rewriting and improving just about all of the code given (and not using the Roomba library at all).</p>
<p>The <a href="https://github.com/thehookup/MQTT-Roomba-ESP01/blob/master/schematic.JPG">schematic</a> is still the same as The Hook Up's guide - so I'm not going to repeat that information here. If you have a Roomba 600 series and it ends up going to sleep on you quite often, you  will need to connect GPIO 0 on the ESP-01S to the BRC pin on the serial interface. When dragged low for a pulse more often than once per minute, this pin stops the Roomba from entering deep sleep. This may not be required on the 500 series (Please leave feedback in the comments!)</p>
<p>When it came to the arduino code, I found many issues.</p>
<ul>
<li>The Roomba would just stop while cleaning, sound a two tone error and stay put.</li>
<li>The Roomba would go to sleep and not respond to start commands.</li>
<li>An error state could put the Roomba in the wrong baud rate needing a manual reset.</li>
<li>There was no debugging information (via a web interface) to see what was going on.</li>
<li>There was no way to update firmware on the device after you unsoldered the header on the ESP01.</li>
<li>Many more minor issues</li>
</ul>
<p>The code below allows you to update the firmware in the ESP01 from any https site. If you only use http on your internal network, or you're using an older version
of the Arduino ESP8266 SDK without the required BearSSL versions, uncomment the following lines:</p>
<pre class="code literal-block"><span class="c1">//#include &lt;ESP8266HTTPClient.h&gt;</span>

<span class="c1">//WiFiClient UpdateClient;</span>
<span class="c1">//t_httpUpdate_return result = ESPhttpUpdate.update(UpdateClient, F("http://10.1.1.93/arduino/update/"));</span>
</pre>
<p>and then comment out the https lines:</p>
<pre class="code literal-block"><span class="n">BearSSL</span><span class="o">::</span><span class="n">WiFiClientSecure</span><span class="w"> </span><span class="n">UpdateClient</span><span class="p">;</span><span class="w"></span>
<span class="n">UpdateClient</span><span class="p">.</span><span class="n">setInsecure</span><span class="p">();</span><span class="w"></span>
<span class="n">t_httpUpdate_return</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ESPhttpUpdate</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">UpdateClient</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="s">"https://10.1.1.93/arduino/update/"</span><span class="p">));</span><span class="w"></span>
</pre>
<p>This will give you a smaller binary - but you'll lose the ability to use https.</p>
<p>I wrote a script that checks the <em>HTTP_X_ESP8266_STA_MAC</em> header provided by the Arduino update client against a known list, then checks the <em>HTTP_X_ESP8266_SKETCH_MD5</em> header.
If the MD5 of the binary file on the server differs, we return a HTTP 200 OK with the binary file, if they match, then we return a HTTP 304. I'll try to put more of these details
online in a different page later on.</p>
<p>If you don't want to do any of the auto-updating, you can just visit the IP address off the ESP01 and click the Update link and upload a new binary that way.</p>
<p>The source code for this project is now in a git repository: <a href="https://git.crc.id.au/netwiz/ESP8266_Code/src/branch/master/Roomba">View the source</a></p>
<p><strong>Changelog</strong></p>
<ul>
<li>2019-02-11 - Fixed num_restarts from always resetting meaning we now stop if 5 restarts fail. Usually this means the Roomba is stuck somewhere.</li>
<li>2019-02-23 - Moved source code into git repository.</li>
</ul>
</div>
    </div>
        <section class="comments"><h2>Comments</h2>
                        <div id="disqus_recommendations" style="margin-bottom: 12px;"><iframe id="dsq-app727" name="dsq-app727" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" width="100%" src="./Hacking the Roomba 600 _ Steve&#39;s Blog_files/saved_resource.html" style="width: 100% !important; border: none !important; overflow: hidden !important; height: 269px !important; display: inline !important; box-sizing: border-box !important;" horizontalscrolling="no" verticalscrolling="no"></iframe></div><div id="disqus_thread"><iframe id="dsq-app1438" name="dsq-app1438" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" width="100%" src="./Hacking the Roomba 600 _ Steve&#39;s Blog_files/saved_resource(1).html" style="width: 1px !important; min-width: 100% !important; border: none !important; overflow: hidden !important; height: 8512px !important;" horizontalscrolling="no" verticalscrolling="no"></iframe></div>
        <script>
        var disqus_shortname ="wwwcrcidau",
            disqus_url="https://www.crc.id.au/hacking-the-roomba-600/",
        disqus_title="Hacking the Roomba 600",
        disqus_identifier="cache/pages/hacking-the-roomba-600.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    


        </section></article>
</div>
            </div>
        </div>
        <button class="btn btn-fab btn-raised btn-material-green btn-footer" data-toggle="modal" data-target="#footer-dialog">
            <i class="mdi-communication-message"></i>
        </button>
        <div id="footer-dialog" class="modal fade" tabindex="-1">
          <div class="modal-dialog">
            <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title">Steve's Blog credits</h4>
              </div>
              <div class="modal-body">
                    Contents © 2021         <a href="mailto:netwiz@crc.id.au">Steven Haigh</a> - Powered by         <a href="https://getnikola.com/" rel="nofollow">Nikola</a>         
                    
              </div>
              <div class="modal-footer">
                <button class="btn btn-primary" data-dismiss="modal">Ok</button>
              </div>
            </div>
          </div>
        </div>
        <div class="source-button">
        </div>
</div>


            <script src="./Hacking the Roomba 600 _ Steve&#39;s Blog_files/all-nocdn.js.download"></script><script>

            $(document).ready(function() {
                // This command is used to initialize some elements and make them work properly
                $.material.init();
            });

            $(window).on("resize", function() {
                if($(window).width() > 767) {
                  $("html, body").height($(window).height());
                  $(".main, .menu").height($(window).height() - $(".header-panel").outerHeight() - 76 );
                  $(".posts-material").height($(window).height());
                } else {
                  $("html, body").css('height', '');
                  $(".main, .menu").css('height', '');
                  $(".posts-material").css('height', '');
                }
            }).trigger("resize");

            function menuToggle() {
                $("nav.menu, ul").toggleClass('responsive', '');
            }
        </script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(1, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><div role="dialog" id="baguetteBox-overlay"><div id="baguetteBox-slider"></div><button type="button" id="previous-button" aria-label="Previous" class="baguetteBox-button"><svg width="44" height="60"><polyline points="30 10 10 30 30 50" stroke="rgba(255,255,255,0.5)" stroke-width="4" stroke-linecap="butt" fill="none" stroke-linejoin="round"></polyline></svg></button><button type="button" id="next-button" aria-label="Next" class="baguetteBox-button"><svg width="44" height="60"><polyline points="14 10 34 30 14 50" stroke="rgba(255,255,255,0.5)" stroke-width="4" stroke-linecap="butt" fill="none" stroke-linejoin="round"></polyline></svg></button><button type="button" id="close-button" aria-label="Close" class="baguetteBox-button"><svg width="30" height="30"><g stroke="rgb(160,160,160)" stroke-width="4"><line x1="5" y1="5" x2="25" y2="25"></line><line x1="5" y1="25" x2="25" y2="5"></line></g></svg></button></div>


<iframe style="display: none;" src="./Hacking the Roomba 600 _ Steve&#39;s Blog_files/saved_resource(2).html"></iframe><iframe style="display: none;" src="./Hacking the Roomba 600 _ Steve&#39;s Blog_files/saved_resource(3).html"></iframe></body></html>